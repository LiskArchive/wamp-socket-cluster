!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("wampSocketCluster",[],t):"object"==typeof exports?exports.wampSocketCluster=t():e.wampSocketCluster=t()}(this,function(){return function(e){function t(n){if(r[n])return r[n].exports;var o=r[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,t),o.l=!0,o.exports}var r={};return t.m=e,t.c=r,t.i=function(e){return e},t.d=function(e,r,n){t.o(e,r)||Object.defineProperty(e,r,{configurable:!1,enumerable:!0,get:n})},t.n=function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(r,"a",r),r},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=20)}([function(e,t,r){"use strict";function n(e,t){return t+": "+e.toString()+"\n"}function o(e,t,r,n){"object"===(void 0===r?"undefined":c(r))?t[n]=a(e[n],r):e.indexOf(r)===-1&&t.push(r)}function i(e,t,r){t[r]=e[r]}function s(e,t,r,n){"object"===c(t[n])&&t[n]&&e[n]?r[n]=a(e[n],t[n]):r[n]=t[n]}function a(e,t){var r=Array.isArray(t),n=r&&[]||{};return r?(e=e||[],n=n.concat(e),t.forEach(o.bind(null,e,n))):(e&&"object"===(void 0===e?"undefined":c(e))&&Object.keys(e).forEach(i.bind(null,e,n)),Object.keys(t).forEach(s.bind(null,e,t,n))),n}function u(e){return"/"+encodeURIComponent(e).replace(/~/g,"%7E")}var c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},l=r(2),h=t.ValidationError=function(e,t,r,n,o,i){n&&(this.property=n),e&&(this.message=e),r&&(r.id?this.schema=r.id:this.schema=r),t&&(this.instance=t),this.name=o,this.argument=i,this.stack=this.toString()};h.prototype.toString=function(){return this.property+" "+this.message};var f=t.ValidatorResult=function(e,t,r,n){this.instance=e,this.schema=t,this.propertyPath=n.propertyPath,this.errors=[],this.throwError=r&&r.throwError,this.disableFormat=r&&r.disableFormat===!0};f.prototype.addError=function(e){var t;if("string"==typeof e)t=new h(e,this.instance,this.schema,this.propertyPath);else{if(!e)throw new Error("Missing error detail");if(!e.message)throw new Error("Missing error message");if(!e.name)throw new Error("Missing validator type");t=new h(e.message,this.instance,this.schema,this.propertyPath,e.name,e.argument)}if(this.throwError)throw t;return this.errors.push(t),t},f.prototype.importErrors=function(e){"string"==typeof e||e&&e.validatorType?this.addError(e):e&&e.errors&&Array.prototype.push.apply(this.errors,e.errors)},f.prototype.toString=function(e){return this.errors.map(n).join("")},Object.defineProperty(f.prototype,"valid",{get:function(){return!this.errors.length}});var p=t.SchemaError=function e(t,r){this.message=t,this.schema=r,Error.call(this,t),Error.captureStackTrace(this,e)};p.prototype=Object.create(Error.prototype,{constructor:{value:p,enumerable:!1},name:{value:"SchemaError",enumerable:!1}});var d=t.SchemaContext=function(e,t,r,n,o){this.schema=e,this.options=t,this.propertyPath=r,this.base=n,this.schemas=o};d.prototype.resolve=function(e){return l.resolve(this.base,e)},d.prototype.makeChild=function(e,t){var r=void 0===t?this.propertyPath:this.propertyPath+y(t),n=l.resolve(this.base,e.id||""),o=new d(e,this.options,r,n,Object.create(this.schemas));return e.id&&!o.schemas[n]&&(o.schemas[n]=e),o};var m=t.FORMAT_REGEXPS={"date-time":/^\d{4}-(?:0[0-9]{1}|1[0-2]{1})-(3[01]|0[1-9]|[12][0-9])[tT ](2[0-4]|[01][0-9]):([0-5][0-9]):(60|[0-5][0-9])(\.\d+)?([zZ]|[+-]([0-5][0-9]):(60|[0-5][0-9]))$/,date:/^\d{4}-(?:0[0-9]{1}|1[0-2]{1})-(3[01]|0[1-9]|[12][0-9])$/,time:/^(2[0-4]|[01][0-9]):([0-5][0-9]):(60|[0-5][0-9])$/,email:/^(?:[\w\!\#\$\%\&\'\*\+\-\/\=\?\^\`\{\|\}\~]+\.)*[\w\!\#\$\%\&\'\*\+\-\/\=\?\^\`\{\|\}\~]+@(?:(?:(?:[a-zA-Z0-9](?:[a-zA-Z0-9\-](?!\.)){0,61}[a-zA-Z0-9]?\.)+[a-zA-Z0-9](?:[a-zA-Z0-9\-](?!$)){0,61}[a-zA-Z0-9]?)|(?:\[(?:(?:[01]?\d{1,2}|2[0-4]\d|25[0-5])\.){3}(?:[01]?\d{1,2}|2[0-4]\d|25[0-5])\]))$/,"ip-address":/^(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/,ipv6:/^\s*((([0-9A-Fa-f]{1,4}:){7}([0-9A-Fa-f]{1,4}|:))|(([0-9A-Fa-f]{1,4}:){6}(:[0-9A-Fa-f]{1,4}|((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){5}(((:[0-9A-Fa-f]{1,4}){1,2})|:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){4}(((:[0-9A-Fa-f]{1,4}){1,3})|((:[0-9A-Fa-f]{1,4})?:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){3}(((:[0-9A-Fa-f]{1,4}){1,4})|((:[0-9A-Fa-f]{1,4}){0,2}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){2}(((:[0-9A-Fa-f]{1,4}){1,5})|((:[0-9A-Fa-f]{1,4}){0,3}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){1}(((:[0-9A-Fa-f]{1,4}){1,6})|((:[0-9A-Fa-f]{1,4}){0,4}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(:(((:[0-9A-Fa-f]{1,4}){1,7})|((:[0-9A-Fa-f]{1,4}){0,5}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))(%.+)?\s*$/,uri:/^[a-zA-Z][a-zA-Z0-9+-.]*:[^\s]*$/,color:/^(#?([0-9A-Fa-f]{3}){1,2}\b|aqua|black|blue|fuchsia|gray|green|lime|maroon|navy|olive|orange|purple|red|silver|teal|white|yellow|(rgb\(\s*\b([0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5])\b\s*,\s*\b([0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5])\b\s*,\s*\b([0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5])\b\s*\))|(rgb\(\s*(\d?\d%|100%)+\s*,\s*(\d?\d%|100%)+\s*,\s*(\d?\d%|100%)+\s*\)))$/,hostname:/^(?=.{1,255}$)[0-9A-Za-z](?:(?:[0-9A-Za-z]|-){0,61}[0-9A-Za-z])?(?:\.[0-9A-Za-z](?:(?:[0-9A-Za-z]|-){0,61}[0-9A-Za-z])?)*\.?$/,"host-name":/^(?=.{1,255}$)[0-9A-Za-z](?:(?:[0-9A-Za-z]|-){0,61}[0-9A-Za-z])?(?:\.[0-9A-Za-z](?:(?:[0-9A-Za-z]|-){0,61}[0-9A-Za-z])?)*\.?$/,alpha:/^[a-zA-Z]+$/,alphanumeric:/^[a-zA-Z0-9]+$/,"utc-millisec":function(e){return"string"==typeof e&&parseFloat(e)===parseInt(e,10)&&!isNaN(e)},regex:function(e){var t=!0;try{new RegExp(e)}catch(e){t=!1}return t},style:/\s*(.+?):\s*([^;]+);?/g,phone:/^\+(?:[0-9] ?){6,14}[0-9]$/};m.regexp=m.regex,m.pattern=m.regex,m.ipv4=m["ip-address"],t.isFormat=function(e,t,r){if("string"==typeof e&&void 0!==m[t]){if(m[t]instanceof RegExp)return m[t].test(e);if("function"==typeof m[t])return m[t](e)}else if(r&&r.customFormats&&"function"==typeof r.customFormats[t])return r.customFormats[t](e);return!0};var y=t.makeSuffix=function(e){return e=e.toString(),e.match(/[.\s\[\]]/)||e.match(/^[\d]/)?e.match(/^\d+$/)?"["+e+"]":"["+JSON.stringify(e)+"]":"."+e};t.deepCompareStrict=function e(t,r){if((void 0===t?"undefined":c(t))!==(void 0===r?"undefined":c(r)))return!1;if(t instanceof Array)return r instanceof Array&&(t.length===r.length&&t.every(function(n,o){return e(t[o],r[o])}));if("object"===(void 0===t?"undefined":c(t))){if(!t||!r)return t===r;var n=Object.keys(t),o=Object.keys(r);return n.length===o.length&&n.every(function(n){return e(t[n],r[n])})}return t===r},e.exports.deepMerge=a,t.objectGetPath=function(e,t){for(var r,n=t.split("/").slice(1);"string"==typeof(r=n.shift());){var o=decodeURIComponent(r.replace(/~0/,"~").replace(/~1/g,"/"));if(!(o in e))return;e=e[o]}return e},t.encodePath=function(e){return e.map(u).join("")}},function(e,t,r){"use strict";function n(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var o,i,s=r(4).Validator,a=new s,u={id:"/WAMPResponse",type:"object",properties:{data:{},error:{},procedure:{type:"string"},signature:{type:"string"},success:{type:"boolean"},type:{type:"string"}},required:["type","procedure","signature","success","error"]},c={id:"/WAMPRequest",type:"object",properties:{data:{},signature:{type:"string"},procedure:{type:"string"},type:{type:"string"}},required:["type","procedure"]},l={id:"/EventRequestSchema",type:"object",properties:{data:{},procedure:{type:"string"},type:{type:"string"}},required:["type","procedure"]},h={id:"/EventResponseSchema",type:"object",properties:{procedure:{type:"string"},type:{type:"string"}},required:["type","procedure"]},f={id:"/MasterWAMPResponse",type:"object",properties:{data:{},error:{},procedure:{type:"string"},signature:{type:"string"},socketId:{type:"string"},success:{type:"boolean"},type:{type:"string"},workerId:{type:"number"}},required:["workerId","socketId","signature","type","procedure","success"]},p={id:"/MasterWAMPRequest",type:"object",properties:{data:{},procedure:{type:"string"},signature:{type:"string"},socketId:{type:"string"},type:{type:"string"},workerId:{type:"number"}},required:["workerId","socketId","type","procedure"]},d={id:"/InterProcessRPCResponseSchema",type:"object",properties:{data:{},error:{},procedure:{type:"string"},signature:{type:"string"},socketId:{type:"string"},success:{type:"boolean"},type:{type:"string"},workerId:{type:"number"}},required:["workerId","socketId","signature","type","procedure","success"]},m={id:"/InterProcessRPCRequestSchema",type:"object",properties:{data:{},procedure:{type:"string"},signature:{type:"string"},socketId:{type:"string"},type:{type:"string"},workerId:{type:"number"}},required:["workerId","socketId","signature","type","procedure"]},y={id:"/MasterConfigResponseSchema",type:"object",properties:{registeredEvents:{type:"array"},config:{type:"object"},type:{type:"string"}},required:["type"]},v={id:"/MasterConfigRequestSchema",type:"object",properties:{type:{type:"string"}},required:["type"]},g=(o={},n(o,u.id,c.id),n(o,f.id,c.id),n(o,d.id,m.id),n(o,y.id,v.id),o),b=(i={},n(i,c.id,u.id),n(i,p.id,u.id),n(i,m.id,d.id),n(i,v.id,y.id),i),w=function(e,t){return a.validate(e,t).valid&&e.type===t.id};e.exports={WAMPRequestSchema:c,WAMPResponseSchema:u,InterProcessRPCRequestSchema:m,InterProcessRPCResponseSchema:d,MasterWAMPResponseSchema:f,MasterWAMPRequestSchema:p,MasterConfigRequestSchema:v,MasterConfigResponseSchema:y,EventRequestSchema:l,EventResponseSchema:h,resToReqMap:g,reqToResMap:b,isValid:w}},function(e,t,r){"use strict";function n(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}function o(e,t,r){if(e&&l.isObject(e)&&e instanceof n)return e;var o=new n;return o.parse(e,t,r),o}function i(e){return l.isString(e)&&(e=o(e)),e instanceof n?e.format():n.prototype.format.call(e)}function s(e,t){return o(e,!1,!0).resolve(t)}function a(e,t){return e?o(e,!1,!0).resolveObject(t):t}var u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},c=r(7),l=r(11);t.parse=o,t.resolve=s,t.resolveObject=a,t.format=i,t.Url=n;var h=/^([a-z0-9.+-]+:)/i,f=/:[0-9]*$/,p=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,d=["<",">",'"',"`"," ","\r","\n","\t"],m=["{","}","|","\\","^","`"].concat(d),y=["'"].concat(m),v=["%","/","?",";","#"].concat(y),g=["/","?","#"],b={javascript:!0,"javascript:":!0},w={javascript:!0,"javascript:":!0},S={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},A=r(10);n.prototype.parse=function(e,t,r){if(!l.isString(e))throw new TypeError("Parameter 'url' must be a string, not "+(void 0===e?"undefined":u(e)));var n=e.indexOf("?"),o=n!==-1&&n<e.indexOf("#")?"?":"#",i=e.split(o);i[0]=i[0].replace(/\\/g,"/"),e=i.join(o);var s=e;if(s=s.trim(),!r&&1===e.split("#").length){var a=p.exec(s);if(a)return this.path=s,this.href=s,this.pathname=a[1],a[2]?(this.search=a[2],this.query=t?A.parse(this.search.substr(1)):this.search.substr(1)):t&&(this.search="",this.query={}),this}var f=h.exec(s);if(f){f=f[0];var d=f.toLowerCase();this.protocol=d,s=s.substr(f.length)}if(r||f||s.match(/^\/\/[^@\/]+@[^@\/]+/)){var m="//"===s.substr(0,2);!m||f&&w[f]||(s=s.substr(2),this.slashes=!0)}if(!w[f]&&(m||f&&!S[f])){for(var E=-1,O=0;O<g.length;O++){var R=s.indexOf(g[O]);R!==-1&&(E===-1||R<E)&&(E=R)}var P,k;k=E===-1?s.lastIndexOf("@"):s.lastIndexOf("@",E),k!==-1&&(P=s.slice(0,k),s=s.slice(k+1),this.auth=decodeURIComponent(P)),E=-1;for(var O=0;O<v.length;O++){var R=s.indexOf(v[O]);R!==-1&&(E===-1||R<E)&&(E=R)}E===-1&&(E=s.length),this.host=s.slice(0,E),s=s.slice(E),this.parseHost(),this.hostname=this.hostname||"";var x="["===this.hostname[0]&&"]"===this.hostname[this.hostname.length-1];if(!x)for(var j=this.hostname.split(/\./),O=0,I=j.length;O<I;O++){var C=j[O];if(C&&!C.match(/^[+a-z0-9A-Z_-]{0,63}$/)){for(var q="",T=0,M=C.length;T<M;T++)C.charCodeAt(T)>127?q+="x":q+=C[T];if(!q.match(/^[+a-z0-9A-Z_-]{0,63}$/)){var F=j.slice(0,O),N=j.slice(O+1),L=C.match(/^([+a-z0-9A-Z_-]{0,63})(.*)$/);L&&(F.push(L[1]),N.unshift(L[2])),N.length&&(s="/"+N.join(".")+s),this.hostname=F.join(".");break}}}this.hostname.length>255?this.hostname="":this.hostname=this.hostname.toLowerCase(),x||(this.hostname=c.toASCII(this.hostname));var $=this.port?":"+this.port:"",_=this.hostname||"";this.host=_+$,this.href+=this.host,x&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),"/"!==s[0]&&(s="/"+s))}if(!b[d])for(var O=0,I=y.length;O<I;O++){var z=y[O];if(s.indexOf(z)!==-1){var U=encodeURIComponent(z);U===z&&(U=escape(z)),s=s.split(z).join(U)}}var W=s.indexOf("#");W!==-1&&(this.hash=s.substr(W),s=s.slice(0,W));var Z=s.indexOf("?");if(Z!==-1?(this.search=s.substr(Z),this.query=s.substr(Z+1),t&&(this.query=A.parse(this.query)),s=s.slice(0,Z)):t&&(this.search="",this.query={}),s&&(this.pathname=s),S[d]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){var $=this.pathname||"",V=this.search||"";this.path=$+V}return this.href=this.format(),this},n.prototype.format=function(){var e=this.auth||"";e&&(e=encodeURIComponent(e),e=e.replace(/%3A/i,":"),e+="@");var t=this.protocol||"",r=this.pathname||"",n=this.hash||"",o=!1,i="";this.host?o=e+this.host:this.hostname&&(o=e+(this.hostname.indexOf(":")===-1?this.hostname:"["+this.hostname+"]"),this.port&&(o+=":"+this.port)),this.query&&l.isObject(this.query)&&Object.keys(this.query).length&&(i=A.stringify(this.query));var s=this.search||i&&"?"+i||"";return t&&":"!==t.substr(-1)&&(t+=":"),this.slashes||(!t||S[t])&&o!==!1?(o="//"+(o||""),r&&"/"!==r.charAt(0)&&(r="/"+r)):o||(o=""),n&&"#"!==n.charAt(0)&&(n="#"+n),s&&"?"!==s.charAt(0)&&(s="?"+s),r=r.replace(/[?#]/g,function(e){return encodeURIComponent(e)}),s=s.replace("#","%23"),t+o+r+s+n},n.prototype.resolve=function(e){return this.resolveObject(o(e,!1,!0)).format()},n.prototype.resolveObject=function(e){if(l.isString(e)){var t=new n;t.parse(e,!1,!0),e=t}for(var r=new n,o=Object.keys(this),i=0;i<o.length;i++){var s=o[i];r[s]=this[s]}if(r.hash=e.hash,""===e.href)return r.href=r.format(),r;if(e.slashes&&!e.protocol){for(var a=Object.keys(e),u=0;u<a.length;u++){var c=a[u];"protocol"!==c&&(r[c]=e[c])}return S[r.protocol]&&r.hostname&&!r.pathname&&(r.path=r.pathname="/"),r.href=r.format(),r}if(e.protocol&&e.protocol!==r.protocol){if(!S[e.protocol]){for(var h=Object.keys(e),f=0;f<h.length;f++){var p=h[f];r[p]=e[p]}return r.href=r.format(),r}if(r.protocol=e.protocol,e.host||w[e.protocol])r.pathname=e.pathname;else{for(var d=(e.pathname||"").split("/");d.length&&!(e.host=d.shift()););e.host||(e.host=""),e.hostname||(e.hostname=""),""!==d[0]&&d.unshift(""),d.length<2&&d.unshift(""),r.pathname=d.join("/")}if(r.search=e.search,r.query=e.query,r.host=e.host||"",r.auth=e.auth,r.hostname=e.hostname||e.host,r.port=e.port,r.pathname||r.search){var m=r.pathname||"",y=r.search||"";r.path=m+y}return r.slashes=r.slashes||e.slashes,r.href=r.format(),r}var v=r.pathname&&"/"===r.pathname.charAt(0),g=e.host||e.pathname&&"/"===e.pathname.charAt(0),b=g||v||r.host&&e.pathname,A=b,E=r.pathname&&r.pathname.split("/")||[],d=e.pathname&&e.pathname.split("/")||[],O=r.protocol&&!S[r.protocol];if(O&&(r.hostname="",r.port=null,r.host&&(""===E[0]?E[0]=r.host:E.unshift(r.host)),r.host="",e.protocol&&(e.hostname=null,e.port=null,e.host&&(""===d[0]?d[0]=e.host:d.unshift(e.host)),e.host=null),b=b&&(""===d[0]||""===E[0])),g)r.host=e.host||""===e.host?e.host:r.host,r.hostname=e.hostname||""===e.hostname?e.hostname:r.hostname,r.search=e.search,r.query=e.query,E=d;else if(d.length)E||(E=[]),E.pop(),E=E.concat(d),r.search=e.search,r.query=e.query;else if(!l.isNullOrUndefined(e.search)){if(O){r.hostname=r.host=E.shift();var R=!!(r.host&&r.host.indexOf("@")>0)&&r.host.split("@");R&&(r.auth=R.shift(),r.host=r.hostname=R.shift())}return r.search=e.search,r.query=e.query,l.isNull(r.pathname)&&l.isNull(r.search)||(r.path=(r.pathname?r.pathname:"")+(r.search?r.search:"")),r.href=r.format(),r}if(!E.length)return r.pathname=null,r.search?r.path="/"+r.search:r.path=null,r.href=r.format(),r;for(var P=E.slice(-1)[0],k=(r.host||e.host||E.length>1)&&("."===P||".."===P)||""===P,x=0,j=E.length;j>=0;j--)P=E[j],"."===P?E.splice(j,1):".."===P?(E.splice(j,1),x++):x&&(E.splice(j,1),x--);if(!b&&!A)for(;x--;x)E.unshift("..");!b||""===E[0]||E[0]&&"/"===E[0].charAt(0)||E.unshift(""),k&&"/"!==E.join("/").substr(-1)&&E.push("");var I=""===E[0]||E[0]&&"/"===E[0].charAt(0);if(O){r.hostname=r.host=I?"":E.length?E.shift():"";var R=!!(r.host&&r.host.indexOf("@")>0)&&r.host.split("@");R&&(r.auth=R.shift(),r.host=r.hostname=R.shift())}return b=b||r.host&&E.length,b&&!I&&E.unshift(""),E.length?r.pathname=E.join("/"):(r.pathname=null,r.path=null),l.isNull(r.pathname)&&l.isNull(r.search)||(r.path=(r.pathname?r.pathname:"")+(r.search?r.search:"")),r.auth=e.auth||r.auth,r.slashes=r.slashes||e.slashes,r.href=r.format(),r},n.prototype.parseHost=function(){var e=this.host,t=f.exec(e);t&&(t=t[0],":"!==t&&(this.port=t.substr(1)),e=e.substr(0,e.length-t.length)),e&&(this.hostname=e)}},function(e,t){(function(t){e.exports=t}).call(t,{})},function(e,t,r){"use strict";var n=e.exports.Validator=r(6);e.exports.ValidatorResult=r(0).ValidatorResult,e.exports.ValidationError=r(0).ValidationError,e.exports.SchemaError=r(0).SchemaError,e.exports.validate=function(e,t,r){return(new n).validate(e,t,r)}},function(e,t,r){"use strict";function n(e,t,r,n,o){var i=this.validateSchema(e,o,t,r);return!i.valid&&n instanceof Function&&n(i),i.valid}function o(e,t,r,n,o,i){if(!t.properties||void 0===t.properties[o])if(t.additionalProperties===!1)i.addError({name:"additionalProperties",argument:o,message:"additionalProperty "+JSON.stringify(o)+" exists in instance when not allowed"});else{var s=t.additionalProperties||{},a=this.validateSchema(e[o],s,r,n.makeChild(s,o));a.instance!==i.instance[o]&&(i.instance[o]=a.instance),i.importErrors(a)}}function i(e,t,r){var n,o=r.length;for(n=t+1,o;n<o;n++)if(a.deepCompareStrict(e,r[n]))return!1;return!0}var s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a=r(0),u=a.ValidatorResult,c=a.SchemaError,l={};l.ignoreProperties={id:!0,default:!0,description:!0,title:!0,exclusiveMinimum:!0,exclusiveMaximum:!0,additionalItems:!0,$schema:!0,$ref:!0,extends:!0};var h=l.validators={};h.type=function(e,t,r,n){if(void 0===e)return null;var o=new u(e,t,r,n),i=Array.isArray(t.type)?t.type:[t.type];if(!i.some(this.testType.bind(this,e,t,r,n))){var s=i.map(function(e){return e.id&&"<"+e.id+">"||e+""});o.addError({name:"type",argument:s,message:"is not of a type(s) "+s})}return o},h.anyOf=function(e,t,r,o){if(void 0===e)return null;var i=new u(e,t,r,o),s=new u(e,t,r,o);if(!Array.isArray(t.anyOf))throw new c("anyOf must be an array");if(!t.anyOf.some(n.bind(this,e,r,o,function(e){s.importErrors(e)}))){var a=t.anyOf.map(function(e,t){return e.id&&"<"+e.id+">"||e.title&&JSON.stringify(e.title)||e.$ref&&"<"+e.$ref+">"||"[subschema "+t+"]"});r.nestedErrors&&i.importErrors(s),i.addError({name:"anyOf",argument:a,message:"is not any of "+a.join(",")})}return i},h.allOf=function(e,t,r,n){if(void 0===e)return null;if(!Array.isArray(t.allOf))throw new c("allOf must be an array");var o=new u(e,t,r,n),i=this;return t.allOf.forEach(function(t,s){var a=i.validateSchema(e,t,r,n);if(!a.valid){var u=t.id&&"<"+t.id+">"||t.title&&JSON.stringify(t.title)||t.$ref&&"<"+t.$ref+">"||"[subschema "+s+"]";o.addError({name:"allOf",argument:{id:u,length:a.errors.length,valid:a},message:"does not match allOf schema "+u+" with "+a.errors.length+" error[s]:"}),o.importErrors(a)}}),o},h.oneOf=function(e,t,r,o){if(void 0===e)return null;if(!Array.isArray(t.oneOf))throw new c("oneOf must be an array");var i=new u(e,t,r,o),s=new u(e,t,r,o),a=t.oneOf.filter(n.bind(this,e,r,o,function(e){s.importErrors(e)})).length,l=t.oneOf.map(function(e,t){return e.id&&"<"+e.id+">"||e.title&&JSON.stringify(e.title)||e.$ref&&"<"+e.$ref+">"||"[subschema "+t+"]"});return 1!==a&&(r.nestedErrors&&i.importErrors(s),i.addError({name:"oneOf",argument:l,message:"is not exactly one from "+l.join(",")})),i},h.properties=function(e,t,r,n){if(void 0!==e&&e instanceof Object){var o=new u(e,t,r,n),i=t.properties||{};for(var s in i){var a=(e||void 0)&&e[s],c=this.validateSchema(a,i[s],r,n.makeChild(i[s],s));c.instance!==o.instance[s]&&(o.instance[s]=c.instance),o.importErrors(c)}return o}},h.patternProperties=function(e,t,r,n){if(void 0!==e&&this.types.object(e)){var i=new u(e,t,r,n),s=t.patternProperties||{};for(var a in e){var c=!0;for(var l in s){if(new RegExp(l).test(a)){c=!1;var h=this.validateSchema(e[a],s[l],r,n.makeChild(s[l],a));h.instance!==i.instance[a]&&(i.instance[a]=h.instance),i.importErrors(h)}}c&&o.call(this,e,t,r,n,a,i)}return i}},h.additionalProperties=function(e,t,r,n){if(void 0!==e&&this.types.object(e)){if(t.patternProperties)return null;var i=new u(e,t,r,n);for(var s in e)o.call(this,e,t,r,n,s,i);return i}},h.minProperties=function(e,t,r,n){if(!e||"object"!==(void 0===e?"undefined":s(e)))return null;var o=new u(e,t,r,n);return Object.keys(e).length>=t.minProperties||o.addError({name:"minProperties",argument:t.minProperties,message:"does not meet minimum property length of "+t.minProperties}),o},h.maxProperties=function(e,t,r,n){if(!e||"object"!==(void 0===e?"undefined":s(e)))return null;var o=new u(e,t,r,n);return Object.keys(e).length<=t.maxProperties||o.addError({name:"maxProperties",argument:t.maxProperties,message:"does not meet maximum property length of "+t.maxProperties}),o},h.items=function(e,t,r,n){if(!Array.isArray(e))return null;var o=this,i=new u(e,t,r,n);return void 0!==e&&t.items?(e.every(function(e,s){var a=Array.isArray(t.items)?t.items[s]||t.additionalItems:t.items;if(void 0===a)return!0;if(a===!1)return i.addError({name:"items",message:"additionalItems not permitted"}),!1;var u=o.validateSchema(e,a,r,n.makeChild(a,s));return u.instance!==i.instance[s]&&(i.instance[s]=u.instance),i.importErrors(u),!0}),i):i},h.minimum=function(e,t,r,n){if("number"!=typeof e)return null;var o=new u(e,t,r,n),i=!0;return i=t.exclusiveMinimum&&t.exclusiveMinimum===!0?e>t.minimum:e>=t.minimum,i||o.addError({name:"minimum",argument:t.minimum,message:"must have a minimum value of "+t.minimum}),o},h.maximum=function(e,t,r,n){if("number"!=typeof e)return null;var o,i=new u(e,t,r,n);return o=t.exclusiveMaximum&&t.exclusiveMaximum===!0?e<t.maximum:e<=t.maximum,o||i.addError({name:"maximum",argument:t.maximum,message:"must have a maximum value of "+t.maximum}),i},h.divisibleBy=function(e,t,r,n){if("number"!=typeof e)return null;if(0==t.divisibleBy)throw new c("divisibleBy cannot be zero");var o=new u(e,t,r,n);return e/t.divisibleBy%1&&o.addError({name:"divisibleBy",argument:t.divisibleBy,message:"is not divisible by (multiple of) "+JSON.stringify(t.divisibleBy)}),o},h.multipleOf=function(e,t,r,n){if("number"!=typeof e)return null;if(0==t.multipleOf)throw new c("multipleOf cannot be zero");var o=new u(e,t,r,n);return e/t.multipleOf%1&&o.addError({name:"multipleOf",argument:t.multipleOf,message:"is not a multiple of (divisible by) "+JSON.stringify(t.multipleOf)}),o},h.required=function(e,t,r,n){var o=new u(e,t,r,n);return void 0===e&&t.required===!0?o.addError({name:"required",message:"is required"}):e&&"object"===(void 0===e?"undefined":s(e))&&Array.isArray(t.required)&&t.required.forEach(function(t){void 0===e[t]&&o.addError({name:"required",argument:t,message:"requires property "+JSON.stringify(t)})}),o},h.pattern=function(e,t,r,n){if("string"!=typeof e)return null;var o=new u(e,t,r,n);return e.match(t.pattern)||o.addError({name:"pattern",argument:t.pattern,message:"does not match pattern "+JSON.stringify(t.pattern)}),o},h.format=function(e,t,r,n){var o=new u(e,t,r,n);return o.disableFormat||a.isFormat(e,t.format,this)||o.addError({name:"format",argument:t.format,message:"does not conform to the "+JSON.stringify(t.format)+" format"}),o},h.minLength=function(e,t,r,n){if("string"!=typeof e)return null;var o=new u(e,t,r,n);return e.length>=t.minLength||o.addError({name:"minLength",argument:t.minLength,message:"does not meet minimum length of "+t.minLength}),o},h.maxLength=function(e,t,r,n){if("string"!=typeof e)return null;var o=new u(e,t,r,n);return e.length<=t.maxLength||o.addError({name:"maxLength",argument:t.maxLength,message:"does not meet maximum length of "+t.maxLength}),o},h.minItems=function(e,t,r,n){if(!Array.isArray(e))return null;var o=new u(e,t,r,n);return e.length>=t.minItems||o.addError({name:"minItems",argument:t.minItems,message:"does not meet minimum length of "+t.minItems}),o},h.maxItems=function(e,t,r,n){if(!Array.isArray(e))return null;var o=new u(e,t,r,n);return e.length<=t.maxItems||o.addError({name:"maxItems",argument:t.maxItems,message:"does not meet maximum length of "+t.maxItems}),o},h.uniqueItems=function(e,t,r,n){function o(e,t,r){for(var n=t+1;n<r.length;n++)if(a.deepCompareStrict(e,r[n]))return!1;return!0}var i=new u(e,t,r,n);return Array.isArray(e)?(e.every(o)||i.addError({name:"uniqueItems",message:"contains duplicate item"}),i):i},h.uniqueItems=function(e,t,r,n){if(!Array.isArray(e))return null;var o=new u(e,t,r,n);return e.every(i)||o.addError({name:"uniqueItems",message:"contains duplicate item"}),o},h.dependencies=function(e,t,r,n){if(!e||"object"!=(void 0===e?"undefined":s(e)))return null;var o=new u(e,t,r,n);for(var i in t.dependencies)if(void 0!==e[i]){var a=t.dependencies[i],c=n.makeChild(a,i);if("string"==typeof a&&(a=[a]),Array.isArray(a))a.forEach(function(t){void 0===e[t]&&o.addError({name:"dependencies",argument:c.propertyPath,message:"property "+t+" not found, required by "+c.propertyPath})});else{var l=this.validateSchema(e,a,r,c);o.instance!==l.instance&&(o.instance=l.instance),l&&l.errors.length&&(o.addError({name:"dependencies",argument:c.propertyPath,message:"does not meet dependency required by "+c.propertyPath}),o.importErrors(l))}}return o},h.enum=function(e,t,r,n){if(!Array.isArray(t.enum))throw new c("enum expects an array",t);if(void 0===e)return null;var o=new u(e,t,r,n);return t.enum.some(a.deepCompareStrict.bind(null,e))||o.addError({name:"enum",argument:t.enum,message:"is not one of enum values: "+t.enum.join(",")}),o},h.not=h.disallow=function(e,t,r,n){var o=this;if(void 0===e)return null;var i=new u(e,t,r,n),s=t.not||t.disallow;return s?(Array.isArray(s)||(s=[s]),s.forEach(function(s){if(o.testType(e,t,r,n,s)){var a=s&&s.id&&"<"+s.id+">"||s;i.addError({name:"not",argument:a,message:"is of prohibited type "+a})}}),i):null},e.exports=l},function(e,t,r){"use strict";function n(e){var t="string"==typeof e?e:e.$ref;return"string"==typeof t&&t}var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i=r(2),s=r(5),a=r(0),u=a.ValidatorResult,c=a.SchemaError,l=a.SchemaContext,h=function e(){this.customFormats=Object.create(e.prototype.customFormats),this.schemas={},this.unresolvedRefs=[],this.types=Object.create(f),this.attributes=Object.create(s.validators)};h.prototype.customFormats={},h.prototype.schemas=null,h.prototype.types=null,h.prototype.attributes=null,h.prototype.unresolvedRefs=null,h.prototype.addSchema=function(e,t){if(!e)return null;var r=t||e.id;return this.addSubSchema(r,e),r&&(this.schemas[r]=e),this.schemas[r]},h.prototype.addSubSchema=function(e,t){if(t&&"object"==(void 0===t?"undefined":o(t))){if(t.$ref){var r=i.resolve(e,t.$ref);return void(void 0===this.schemas[r]&&(this.schemas[r]=null,this.unresolvedRefs.push(r)))}var n=t.id&&i.resolve(e,t.id),s=n||e;if(n){if(this.schemas[n]){if(!a.deepCompareStrict(this.schemas[n],t))throw new Error("Schema <"+t+"> already exists with different definition");return this.schemas[n]}this.schemas[n]=t;var u=n.replace(/^([^#]*)#$/,"$1");this.schemas[u]=t}return this.addSubSchemaArray(s,t.items instanceof Array?t.items:[t.items]),this.addSubSchemaArray(s,t.extends instanceof Array?t.extends:[t.extends]),this.addSubSchema(s,t.additionalItems),this.addSubSchemaObject(s,t.properties),this.addSubSchema(s,t.additionalProperties),this.addSubSchemaObject(s,t.definitions),this.addSubSchemaObject(s,t.patternProperties),this.addSubSchemaObject(s,t.dependencies),this.addSubSchemaArray(s,t.disallow),this.addSubSchemaArray(s,t.allOf),this.addSubSchemaArray(s,t.anyOf),this.addSubSchemaArray(s,t.oneOf),this.addSubSchema(s,t.not),this.schemas[n]}},h.prototype.addSubSchemaArray=function(e,t){if(t instanceof Array)for(var r=0;r<t.length;r++)this.addSubSchema(e,t[r])},h.prototype.addSubSchemaObject=function(e,t){if(t&&"object"==(void 0===t?"undefined":o(t)))for(var r in t)this.addSubSchema(e,t[r])},h.prototype.setSchemas=function(e){this.schemas=e},h.prototype.getSchema=function(e){return this.schemas[e]},h.prototype.validate=function(e,t,r,n){r||(r={});var o=r.propertyName||"instance",s=i.resolve(r.base||"/",t.id||"");if(n||(n=new l(t,r,o,s,Object.create(this.schemas)),n.schemas[s]||(n.schemas[s]=t)),t){var a=this.validateSchema(e,t,r,n);if(!a)throw new Error("Result undefined");return a}throw new c("no schema specified",t)},h.prototype.validateSchema=function(e,t,r,o){var i=new u(e,t,r,o);if(!t)throw new Error("schema is undefined");if(t.extends)if(t.extends instanceof Array){var h={schema:t,ctx:o};t.extends.forEach(this.schemaTraverser.bind(this,h)),t=h.schema,h.schema=null,h.ctx=null,h=null}else t=a.deepMerge(t,this.superResolve(t.extends,o));var f;if(f=n(t)){var p=this.resolve(t,f,o),d=new l(p.subschema,r,o.propertyPath,p.switchSchema,o.schemas);return this.validateSchema(e,p.subschema,r,d)}var m=r&&r.skipAttributes||[];for(var y in t)if(!s.ignoreProperties[y]&&m.indexOf(y)<0){var v=null,g=this.attributes[y];if(g)v=g.call(this,e,t,r,o);else if(r.allowUnknownAttributes===!1)throw new c("Unsupported attribute: "+y,t);v&&i.importErrors(v)}if("function"==typeof r.rewrite){var b=r.rewrite.call(this,e,t,r,o);i.instance=b}return i},h.prototype.schemaTraverser=function(e,t){e.schema=a.deepMerge(e.schema,this.superResolve(t,e.ctx))},h.prototype.superResolve=function(e,t){var r;return(r=n(e))?this.resolve(e,r,t).subschema:e},h.prototype.resolve=function(e,t,r){if(t=r.resolve(t),r.schemas[t])return{subschema:r.schemas[t],switchSchema:t};var n=i.parse(t),o=n&&n.hash,s=o&&o.length&&t.substr(0,t.length-o.length);if(!s||!r.schemas[s])throw new c("no such schema <"+t+">",e);var u=a.objectGetPath(r.schemas[s],o.substr(1));if(void 0===u)throw new c("no such schema "+o+" located in <"+s+">",e);return{subschema:u,switchSchema:t}},h.prototype.testType=function(e,t,r,n,i){if("function"==typeof this.types[i])return this.types[i].call(this,e);if(i&&"object"==(void 0===i?"undefined":o(i))){var s=this.validateSchema(e,i,r,n);return void 0===s||!(s&&s.errors.length)}return!0};var f=h.prototype.types={};f.string=function(e){return"string"==typeof e},f.number=function(e){return"number"==typeof e&&isFinite(e)},f.integer=function(e){return"number"==typeof e&&e%1==0},f.boolean=function(e){return"boolean"==typeof e},f.array=function(e){return e instanceof Array},f.null=function(e){return null===e},f.date=function(e){return e instanceof Date},f.any=function(e){return!0},f.object=function(e){return e&&"object"===(void 0===e?"undefined":o(e))&&!(e instanceof Array)&&!(e instanceof Date)},e.exports=h},function(e,t,r){"use strict";(function(e,n){var o,i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};!function(s){function a(e){throw new RangeError(N[e])}function u(e,t){for(var r=e.length,n=[];r--;)n[r]=t(e[r]);return n}function c(e,t){var r=e.split("@"),n="";return r.length>1&&(n=r[0]+"@",e=r[1]),e=e.replace(F,"."),n+u(e.split("."),t).join(".")}function l(e){for(var t,r,n=[],o=0,i=e.length;o<i;)t=e.charCodeAt(o++),t>=55296&&t<=56319&&o<i?(r=e.charCodeAt(o++),56320==(64512&r)?n.push(((1023&t)<<10)+(1023&r)+65536):(n.push(t),o--)):n.push(t);return n}function h(e){return u(e,function(e){var t="";return e>65535&&(e-=65536,t+=_(e>>>10&1023|55296),e=56320|1023&e),t+=_(e)}).join("")}function f(e){return e-48<10?e-22:e-65<26?e-65:e-97<26?e-97:R}function p(e,t){return e+22+75*(e<26)-((0!=t)<<5)}function d(e,t,r){var n=0;for(e=r?$(e/j):e>>1,e+=$(e/t);e>L*k>>1;n+=R)e=$(e/L);return $(n+(L+1)*e/(e+x))}function m(e){var t,r,n,o,i,s,u,c,l,p,m=[],y=e.length,v=0,g=C,b=I;for(r=e.lastIndexOf(q),r<0&&(r=0),n=0;n<r;++n)e.charCodeAt(n)>=128&&a("not-basic"),m.push(e.charCodeAt(n));for(o=r>0?r+1:0;o<y;){for(i=v,s=1,u=R;o>=y&&a("invalid-input"),c=f(e.charCodeAt(o++)),(c>=R||c>$((O-v)/s))&&a("overflow"),v+=c*s,l=u<=b?P:u>=b+k?k:u-b,!(c<l);u+=R)p=R-l,s>$(O/p)&&a("overflow"),s*=p;t=m.length+1,b=d(v-i,t,0==i),$(v/t)>O-g&&a("overflow"),g+=$(v/t),v%=t,m.splice(v++,0,g)}return h(m)}function y(e){var t,r,n,o,i,s,u,c,h,f,m,y,v,g,b,w=[];for(e=l(e),y=e.length,t=C,r=0,i=I,s=0;s<y;++s)(m=e[s])<128&&w.push(_(m));for(n=o=w.length,o&&w.push(q);n<y;){for(u=O,s=0;s<y;++s)(m=e[s])>=t&&m<u&&(u=m);for(v=n+1,u-t>$((O-r)/v)&&a("overflow"),r+=(u-t)*v,t=u,s=0;s<y;++s)if(m=e[s],m<t&&++r>O&&a("overflow"),m==t){for(c=r,h=R;f=h<=i?P:h>=i+k?k:h-i,!(c<f);h+=R)b=c-f,g=R-f,w.push(_(p(f+b%g,0))),c=$(b/g);w.push(_(p(c,0))),i=d(r,v,n==o),r=0,++n}++r,++t}return w.join("")}function v(e){return c(e,function(e){return T.test(e)?m(e.slice(4).toLowerCase()):e})}function g(e){return c(e,function(e){return M.test(e)?"xn--"+y(e):e})}var b="object"==i(t)&&t&&!t.nodeType&&t,w="object"==i(e)&&e&&!e.nodeType&&e,S="object"==(void 0===n?"undefined":i(n))&&n;S.global!==S&&S.window!==S&&S.self!==S||(s=S);var A,E,O=2147483647,R=36,P=1,k=26,x=38,j=700,I=72,C=128,q="-",T=/^xn--/,M=/[^\x20-\x7E]/,F=/[\x2E\u3002\uFF0E\uFF61]/g,N={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},L=R-P,$=Math.floor,_=String.fromCharCode;if(A={version:"1.4.1",ucs2:{decode:l,encode:h},decode:m,encode:y,toASCII:g,toUnicode:v},"object"==i(r(3))&&r(3))void 0!==(o=function(){return A}.call(t,r,t,e))&&(e.exports=o);else if(b&&w)if(e.exports==b)w.exports=A;else for(E in A)A.hasOwnProperty(E)&&(b[E]=A[E]);else s.punycode=A}(void 0)}).call(t,r(13)(e),r(12))},function(e,t,r){"use strict";function n(e,t){return Object.prototype.hasOwnProperty.call(e,t)}e.exports=function(e,t,r,i){t=t||"&",r=r||"=";var s={};if("string"!=typeof e||0===e.length)return s;e=e.split(t);var a=1e3;i&&"number"==typeof i.maxKeys&&(a=i.maxKeys);var u=e.length;a>0&&u>a&&(u=a);for(var c=0;c<u;++c){var l,h,f,p,d=e[c].replace(/\+/g,"%20"),m=d.indexOf(r);m>=0?(l=d.substr(0,m),h=d.substr(m+1)):(l=d,h=""),f=decodeURIComponent(l),p=decodeURIComponent(h),n(s,f)?o(s[f])?s[f].push(p):s[f]=[s[f],p]:s[f]=p}return s};var o=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)}},function(e,t,r){"use strict";function n(e,t){if(e.map)return e.map(t);for(var r=[],n=0;n<e.length;n++)r.push(t(e[n],n));return r}var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i=function(e){switch(void 0===e?"undefined":o(e)){case"string":return e;case"boolean":return e?"true":"false";case"number":return isFinite(e)?e:"";default:return""}};e.exports=function(e,t,r,u){return t=t||"&",r=r||"=",null===e&&(e=void 0),"object"===(void 0===e?"undefined":o(e))?n(a(e),function(o){var a=encodeURIComponent(i(o))+r;return s(e[o])?n(e[o],function(e){return a+encodeURIComponent(i(e))}).join(t):a+encodeURIComponent(i(e[o]))}).join(t):u?encodeURIComponent(i(u))+r+encodeURIComponent(i(e)):""};var s=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},a=Object.keys||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.push(r);return t}},function(e,t,r){"use strict";t.decode=t.parse=r(8),t.encode=t.stringify=r(9)},function(e,t,r){"use strict";var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};e.exports={isString:function(e){return"string"==typeof e},isObject:function(e){return"object"===(void 0===e?"undefined":n(e))&&null!==e},isNull:function(e){return null===e},isNullOrUndefined:function(e){return null==e}}},function(e,t,r){"use strict";var n,o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};n=function(){return this}();try{n=n||Function("return this")()||(0,eval)("this")}catch(e){"object"===("undefined"==typeof window?"undefined":o(window))&&(n=window)}e.exports=n},function(e,t,r){"use strict";e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),e.webpackPolyfill=1),e}},function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var o=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(1),s=function(){function e(){n(this,e),this.endpoints={rpc:{},event:{}}}return o(e,[{key:"upgradeToWAMP",value:function(e){var t=this;return e.on("raw",function(r){var n=void 0;try{n=JSON.parse(r)}catch(e){return}i.isValid(n,i.WAMPRequestSchema)&&t.processWAMPRequest(n,e)}),Object.keys(this.endpoints.event).forEach(function(r){e.on(r,function(n){t.processWAMPRequest({type:i.EventRequestSchema.id,procedure:r,data:n},e)})}),e}},{key:"processWAMPRequest",value:function(e,t){return this.endpoints.rpc[e.procedure]&&"function"==typeof this.endpoints.rpc[e.procedure]?this.endpoints.rpc[e.procedure](e.data,this.reply.bind(this,t,e)):(this.endpoints.event[e.procedure]&&"function"==typeof this.endpoints.event[e.procedure]&&(this.endpoints.event[e.procedure](e.data),t.send(JSON.stringify({procedure:e.procedure,type:i.EventResponseSchema}))),this.reply(t,e,"Procedure "+e.procedure+" not registered on WAMPServer. \n\t\t\tAvailable commands: "+JSON.stringify(Object.keys(this.endpoints.rpc)),null))}},{key:"reply",value:function(t,r,n,o){var i=e.createResponsePayload(r,n,o);t.send(JSON.stringify(i))}},{key:"registerRPCEndpoints",value:function(e){this.endpoints.rpc=Object.assign(this.endpoints.rpc,e)}},{key:"registerEventEndpoints",value:function(e){this.endpoints.event=Object.assign(this.endpoints.event,e)}},{key:"reassignRPCEndpoints",value:function(e){this.endpoints.rpc=e}},{key:"reassignEventEndpoints",value:function(e){this.endpoints.event=e}}],[{key:"createResponsePayload",value:function(e,t,r){return Object.assign({},e,{success:!t,data:r,error:t,type:i.reqToResMap[e.type]})}}]),e}();e.exports=s},function(e,t,r){"use strict";var n={get:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0;if("string"!=typeof t)return r;for(var n=t.split("."),o=e,i=0;i<n.length;i+=1)if(void 0===(o=o[n[i]]))return r;return o}};e.exports=n},function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var o=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(15).get,s=r(1),a=function(){function e(){var t=this,o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1e4;n(this,e),this.callsResolvers={},this.requestsTimeoutMs=o,setInterval(function(){console.log("***** STATE OF CALLS RESOLVERS --- START *****"),Object.keys(t.callsResolvers).forEach(function(e){console.log("Procedure:",e),console.log("Calls:",Object.keys(t.callsResolvers[e])),console.log("Calls length:",Object.keys(t.callsResolvers[e]).length)}),console.log("***** STATE OF CALLS RESOLVERS ---  END  *****")},1e4),setInterval(function(){console.log("PERFORMING EVERY HOUR HEAP SNAPSHOT"),r(17).writeSnapshot("./"+Date.now()+"wamp-socket-cluster-without-get-and-set.heapsnapshot")},6e4)}return o(e,null,[{key:"generateSignature",value:function(t){for(var r=0;r<e.MAX_GENERATE_ATTEMPTS;){var n=(new Date).getTime()+"_"+function(){return Math.ceil(1e4*Math.random())}();if(!t[n])return n;r+=1}return null}},{key:"MAX_CALLS_ALLOWED",get:function(){return 100}},{key:"MAX_GENERATE_ATTEMPTS",get:function(){return 1e4}}]),o(e,[{key:"upgradeToWAMP",value:function(t){var r=this;if(t.wampSend&&t.listeners("raw").length)return t;var n=t,o=function(e){try{return JSON.parse(e)}catch(t){return e}};return n.on("raw",function(e){var t=o(e);if(s.isValid(t,s.WAMPResponseSchema)){var n=i(r.callsResolvers,t.procedure+"."+t.signature);if(!n)throw new Error("Unable to find resolving function for procedure "+t.procedure+" with signature "+t.signature);t.success?n.success(t.data):n.fail(t.error),clearTimeout(n.requestTimeout),delete r.callsResolvers[t.procedure][t.signature]}}),n.wampSend=function(n,o){return new Promise(function(i,a){if(r.callsResolvers[n]||(r.callsResolvers[n]={}),Object.keys(r.callsResolvers[n]).length>=e.MAX_CALLS_ALLOWED)a("No more than "+e.MAX_CALLS_ALLOWED+" calls allowed");else{var u=e.generateSignature(r.callsResolvers[n]);if(u){var c=setTimeout(function(){delete r.callsResolvers[n][u],a("RPC response timeout exceeded")},r.requestsTimeoutMs);r.callsResolvers[n][u]={success:i,fail:a,requestTimeout:c},t.send(JSON.stringify({data:o,procedure:n,signature:u,type:s.WAMPRequestSchema.id}))}else a("Failed to generate proper signature "+e.MAX_GENERATE_ATTEMPTS+" times")}})},n}}]),e}();e.exports=a},function(e,t,r){"use strict";(function(e){try{var n=r(!function(){var e=new Error('Cannot find module "../build/Release/addon"');throw e.code="MODULE_NOT_FOUND",e}())}catch(e){if("MODULE_NOT_FOUND"!==e.code)throw e;var n=r(!function(){var e=new Error('Cannot find module "../build/Debug/addon"');throw e.code="MODULE_NOT_FOUND",e}())}for(var o=n.kForkFlag,i=n.kSignalFlag,s=i,a=(e.env.NODE_HEAPDUMP_OPTIONS||"").split(/\s*,\s*/),u=0,c=a.length;u<c;u+=1){var l=a[u];""!==l&&("fork"===l?s|=o:"signal"===l?s|=i:"nofork"===l?s&=~o:"nosignal"===l?s&=~i:console.error("node-heapdump: unrecognized option:",l))}n.configure(s),t.writeSnapshot=function(){return n.writeSnapshot.apply(null,arguments)}}).call(t,r(18))},function(e,t,r){"use strict";function n(){throw new Error("setTimeout has not been defined")}function o(){throw new Error("clearTimeout has not been defined")}function i(e){if(h===setTimeout)return setTimeout(e,0);if((h===n||!h)&&setTimeout)return h=setTimeout,setTimeout(e,0);try{return h(e,0)}catch(t){try{return h.call(null,e,0)}catch(t){return h.call(this,e,0)}}}function s(e){if(f===clearTimeout)return clearTimeout(e);if((f===o||!f)&&clearTimeout)return f=clearTimeout,clearTimeout(e);try{return f(e)}catch(t){try{return f.call(null,e)}catch(t){return f.call(this,e)}}}function a(){y&&d&&(y=!1,d.length?m=d.concat(m):v=-1,m.length&&u())}function u(){if(!y){var e=i(a);y=!0;for(var t=m.length;t;){for(d=m,m=[];++v<t;)d&&d[v].run();v=-1,t=m.length}d=null,y=!1,s(e)}}function c(e,t){this.fun=e,this.array=t}function l(){}var h,f,p=e.exports={};!function(){try{h="function"==typeof setTimeout?setTimeout:n}catch(e){h=n}try{f="function"==typeof clearTimeout?clearTimeout:o}catch(e){f=o}}();var d,m=[],y=!1,v=-1;p.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];m.push(new c(e,t)),1!==m.length||y||i(u)},c.prototype.run=function(){this.fun.apply(null,this.array)},p.title="browser",p.browser=!0,p.env={},p.argv=[],p.version="",p.versions={},p.on=l,p.addListener=l,p.once=l,p.off=l,p.removeListener=l,p.removeAllListeners=l,p.emit=l,p.binding=function(e){throw new Error("process.binding is not supported")},p.cwd=function(){return"/"},p.chdir=function(e){throw new Error("process.chdir is not supported")},p.umask=function(){return 0}},,function(e,t,r){"use strict";function n(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var a=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),u=r(4).Validator,c=r(15).get,l=r(14),h=r(16),f=r(1),p=new u,d=function(e){function t(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e4,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){};o(this,t);var a=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return a.worker=e,a.sockets=e.scServer.clients,a.interProcessRPC={},a.endpoints.slaveRpc={},a.config={},a.internalRequestsTimeoutMs=r,a.worker.on("masterMessage",function(e){if(f.isValid(e,f.MasterWAMPResponseSchema)||f.isValid(e,f.WAMPResponseSchema)){var t=a.sockets[e.socketId];if(!t)throw new Error("Socket that requested RPC call not found anymore");delete e.socketId,delete e.workerId,e.type=f.WAMPRequestSchema.id,a.reply(t,e,e.error,e.data)}else if(f.isValid(e,f.InterProcessRPCResponseSchema)){var r=a.getCall(e);r&&(r(e.error,e.data),a.deleteCall(e))}else f.isValid(e,f.MasterConfigResponseSchema)&&(a.config=Object.assign({},a.config,e.config),e.registeredEvents&&a.registerEventEndpoints(e.registeredEvents.reduce(function(e,t){return Object.assign(e,n({},t,function(){}))},{})),s(null,a))}),a}return s(t,e),a(t,[{key:"sendToMaster",value:function(e,r,n,o){var i=t.normalizeRequest({type:f.InterProcessRPCRequestSchema.id,procedure:e,data:r,socketId:n,workerId:this.worker.id,signature:h.generateSignature(c(this.interProcessRPC,n+"."+e,{}))});this.worker.sendToMaster(i),this.saveCall(i,o)}},{key:"processWAMPRequest",value:function(e,t){p.validate(e,f.WAMPRequestSchema).valid&&(e.socketId=t.id,e.workerId=this.worker.id,this.endpoints.slaveRpc[e.procedure]&&"function"==typeof this.endpoints.slaveRpc[e.procedure]?this.endpoints.slaveRpc[e.procedure](e,this.reply.bind(this,t,e)):(e.type=f.MasterWAMPRequestSchema.id,this.worker.sendToMaster(e)))}},{key:"onSocketDisconnect",value:function(e){return delete this.interProcessRPC[e]}},{key:"saveCall",value:function(e,t){var r=this;if(!e)throw new Error("Internal error while attempting to save InterProcessRPCRequest: empty request");if(!e.socketId)throw new Error("Internal error while attempting to save InterProcessRPCRequest: missing socketId");if(!e.procedure)throw new Error("Internal error while attempting to save InterProcessRPCRequest: missing procedure");if(!e.signature)throw new Error("Internal error while attempting to save InterProcessRPCRequest: missing signature");if(!t)throw new Error("Cannot save a call without callback");var n=setTimeout(function(){t("RPC response timeout exceeded"),r.deleteCall(e)},this.internalRequestsTimeoutMs);this.interProcessRPC[e.socketId]||(this.interProcessRPC[e.socketId]={}),this.interProcessRPC[e.socketId][e.procedure]||(this.interProcessRPC[e.socketId][e.procedure]={}),this.interProcessRPC[e.socketId][e.procedure][e.signature]={callback:t,requestTimeout:n}}},{key:"getCall",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return c(this.interProcessRPC,e.socketId+"."+e.procedure+"."+e.signature+".callback",!1)}},{key:"getRequestTimeout",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return c(this.interProcessRPC,e.socketId+"."+e.procedure+"."+e.signature+".requestTimeout",!1)}},{key:"deleteCall",value:function(e){if(!e)throw new Error("Internal error while attempting to delete InterProcessRPCRequest: empty request");if(!e.socketId)throw new Error("Internal error while attempting to delete InterProcessRPCRequest: missing socketId");if(!e.procedure)throw new Error("Internal error while attempting to delete InterProcessRPCRequest: missing procedure");if(!e.signature)throw new Error("Internal error while attempting to delete InterProcessRPCRequest: missing signature");if(!this.getCall(e))throw new Error("There are no internal requests registered for socket: "+e.socketId+", procedure: "+e.procedure+" with signature "+e.signature);return clearTimeout(this.getRequestTimeout(e)),delete this.interProcessRPC[e.socketId][e.procedure][e.signature]}},{key:"reassignRPCSlaveEndpoints",value:function(e){this.endpoints.slaveRpc=e}},{key:"registerRPCSlaveEndpoints",value:function(e){this.endpoints.slaveRpc=Object.assign(this.endpoints.slaveRpc,e)}}],[{key:"normalizeRequest",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!e.procedure||"string"!=typeof e.procedure)throw new Error("Wrong format of requested procedure: "+e.procedure);if(!e.socketId||"string"!=typeof e.socketId)throw new Error("Wrong format of requested socket id: "+e.socketId);return e.procedure=e.procedure.replace(/\./g,""),e.socketId=e.socketId.replace(/\./g,""),e}}]),t}(l);e.exports=d}])});