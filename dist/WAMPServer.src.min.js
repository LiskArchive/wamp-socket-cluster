!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("jsonschema")):"function"==typeof define&&define.amd?define("wampSocketCluster",["jsonschema"],t):"object"==typeof exports?exports.wampSocketCluster=t(require("jsonschema")):e.wampSocketCluster=t(e.jsonschema)}(this,function(e){return function(e){function t(r){if(n[r])return n[r].exports;var o=n[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,t),o.l=!0,o.exports}var n={};return t.m=e,t.c=n,t.i=function(e){return e},t.d=function(e,n,r){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:r})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=2)}([function(e,t,n){"use strict";function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var o,i=n(1).Validator,s=new i,p={id:"/RPCResponse",type:"object",properties:{type:{type:"string"},data:{}},required:["type","data"]},u={id:"/RPCRequest",type:"object",properties:{type:{type:"string"},procedure:{type:"string"},data:{}},required:["type","procedure"]},c={id:"/EventRequestSchema",type:"object",properties:{type:{type:"string"},procedure:{type:"string"},data:{}},required:["type","procedure"]},a={id:"/MasterRPCRequest",type:"object",properties:{type:{type:"string"},procedure:{type:"string"},data:{}},required:["type","procedure"]},d={id:"/InterProcessRPCRequestSchema",type:"object",properties:{type:{type:"string"},procedure:{type:"string"},data:{}},required:["type","procedure"]},f={id:"/MasterConfigRequestSchema",type:"object",properties:{type:{type:"string"},registeredEvents:{type:"array"},config:{type:"object"}},required:["type","registeredEvents","config"]},y=r({},p.id,u.id),l=(o={},r(o,u.id,p.id),r(o,a.id,p.id),o),h=function(e,t){return s.validate(e,t).valid&&e.type===t.id};e.exports={EventRequestSchema:c,RPCRequestSchema:u,RPCResponseSchema:p,InterProcessRPCRequestSchema:d,MasterRPCRequestSchema:a,MasterConfigRequestSchema:f,resToReqMap:y,reqToResMap:l,isValid:h}},function(e,t){e.exports=require("jsonschema")},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=n(0),s=function(){function e(){r(this,e),this.endpoints={rpc:{},event:{}}}return o(e,[{key:"upgradeToWAMP",value:function(e){var t=this;return e.on("rpc-request",function(n,r){i.isValid(n,i.RPCRequestSchema)?(n.socketId=e.id,t.processWAMPRequest(n,r)):r('Failed to process RPC request "'+n.procedure+'" because the request schema was not valid')}),Object.keys(this.endpoints.event).forEach(function(n){"function"==typeof t.endpoints.event[n]&&e.on(n,t.endpoints.event[n])}),e}},{key:"processWAMPRequest",value:function(e,t){var n=this,r=function(e,t){return n.endpoints[e][t]&&"function"==typeof n.endpoints[e][t]};return r("rpc",e.procedure)?this.endpoints.rpc[e.procedure](e.data,function(e,n){t(e,{type:i.RPCResponseSchema.id,data:n})}):r("event",e.procedure)?this.endpoints.event[e.procedure](e.data):t("Procedure "+e.procedure+" not registered on WAMPServer. Available commands: "+this.endpoints)}},{key:"registerRPCEndpoints",value:function(e){this.endpoints.rpc=Object.assign(this.endpoints.rpc,e)}},{key:"registerEventEndpoints",value:function(e){this.endpoints.event=Object.assign(this.endpoints.event,e)}},{key:"reassignRPCEndpoints",value:function(e){this.endpoints.rpc=e}},{key:"reassignEventEndpoints",value:function(e){this.endpoints.event=e}}]),e}();e.exports=s}])});